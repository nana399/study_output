## リクエストからレスポンスまでの流れについて(GET編)

### 状況

とあるSNSアプリがあります。ユーザーの一覧ページがブラウザに表示されるまでの流れを説明しましょう。
<br>

1. ブラウザのURLバーに/usersと打ってエンターを押すと`GET /users`のリクエストがWebサーバーに送られる。
2. `ルーティング`がそのリクエストに対応する`コントローラ`と`アクション`を割り当て実行する。
3. コントローラの`index`アクションで、「`@users = User.all`」とコードを記述し、全ユーザーのデータを取得する。
4. インスタンス変数である`@users`に代入される。
5. ビューがこれらの情報を基にHTMLを作成し、Webサーバーを通ってHTMLがレスポンスとして送られる。
6. それを`ブラウザ`が表示する。
<br>

なぜ `users_controller`が使われるのかというと、
ルーティングはルートURLを特定のコントローラ内アクションへ割り当てる役割を持っており、
今回の問題で当てはめると、URLが`/users`なので、`users_controller`が呼ばれたという流れ。
<br>

## **リクエストからレスポンスまでの流れについて(POST編)**

### 状況

とあるタスク管理アプリがあります。タスクを新規作成するときの流れを説明してください。
<br>

### 新規作成ページを表示する

<br>
1. `/tasks/new`というURLに対して`GET`リクエストがWebサーバーに送られる。<br>

2. `ルーティング`がそのリクエストに対応する`コントローラ`と`アクション`を割り当て実行する。

3. `コントローラ`が、newアクションで呼んで

```
def new
  @task = Task.new
end
```
と記述することにより、新しいオブジェクトを作り出す。

4. ビューがこれらの情報を基にHTMLを作成し、Webサーバーを通ってHTMLがレスポンスとして送られる。

5. それを`ブラウザ`が表示する。
<br>
[![Image from Gyazo](https://i.gyazo.com/e52e971085f60d5d6aefeae652567966.gif)](https://gyazo.com/e52e971085f60d5d6aefeae652567966)
<br>
<br>
## タスク名(name)を入力する

``app/views/tasks/new.html.slimがnew`アクション`に対応する。

`form_with`という`メソッド`を利用し、登録フォームを表示させる。

フォームの内部には、.form-groupというbootstrapで用意しているデザイン要素が配置されている。

## 作成ボタンを押す

タスクの作成ボタンを押すと、`POST`メソッドがWebブラウザに送られる。
[![Image from Gyazo](https://i.gyazo.com/7f7c43c9dd048788ad02bb759681afd2.gif)](https://gyazo.com/7f7c43c9dd048788ad02bb759681afd2)

## タスクの詳細画面に遷移する

【流れ】

ユーザーは一覧画面から興味のあるタスクを探し、タスクの名称をクリックすると詳細画面に遷移する。

【手順】

1.**クリックするとtasks/[タスクのID]という詳細表示のURLに遷移するプログラムを書く**
<br>

`app/views/tasks/index.html.slim` で、

```ruby
td= link_to task.name, task
```

とコードを書く。

2.**指定されたタスクを詳細画面で取得する**

TasksControllerのshowアクションに

```ruby
def show
  @task = Task.find(params[:id])
end
```

とコードを書く。
<br>
こうすることでfindメソッドが詳細画面に表示するためのTaskオブジェクトを取得する。findはidによってモデルオブジェクトに対応するレコードをデータベースから検索し、引数として`params[:id]`を渡す。
<br>
`params[:id]`にはリクエストパラメータ（params）から得られる`URL"tasks/[タスクのid]"`の`[タスクのid]`の部分が格納されている。
<br>

ここで取得されたTaskオブジェクトは、`@task`というインスタンス変数に代入して`ビュー`に伝えられる。
